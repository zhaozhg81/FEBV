library(latex2exp)
library(REBayes)
library(Rmosek)

CI_Ind <- function(G, numSim, N, n, prior, a, b, PLOT=FALSE, bw= 'ucv' )
{

  
  if(PLOT==FALSE)
    {
      
      ## ##-- Setting Parameters ----------------------------------------------------------------------------------------------------------------------------------------------
      
      ## G       <- 1000   # Dimension
      ## numSim  <- 500   # The number of simulation
      ## N       <- 20     # The Number of ticks for X-axis
      ## n       <- 6      # Sample size  (df=n-1)

      ##-- Indep Core ------------------------------------------------------------------------------------------------------------------------------------------------------
      
      df      <- n-1   # Degree of Freedom
      mu      <- 0     # Mean of prior distrubution
      alpha   <- 0.05
      
      GAM     <-0
      INVGAM  <-0
      LNORM   <-0
      MIXIG   <-0
      MIXGAM  <-0

      Ncol    <- 13
      theta   <- array(0, G)
      sigmaSq <- array(0, G)
      bon     <- array(0, G)
      sSq     <- array(0, G)
      ljs     <- array(0, G)
      opt     <- array(0, G)
      smy     <- array(0, G)
      vsh     <- array(0, G)
      feb     <- array(0, G)
      fes     <- array(0, G)
      reb     <- array(0, G)
      Feb     <- array(0, G)
      
      
      CI.bon.sel.unknown       <- array(0, c(numSim,Ncol))
      CI.sSq.sel.unknown       <- array(0, c(numSim,Ncol))
      CI.ljs.sel.unknown       <- array(0, c(numSim,Ncol))
      CI.opt.sel.unknown       <- array(0, c(numSim,Ncol))
      CI.smy.sel.unknown       <- array(0, c(numSim,Ncol))
      CI.vsh.sel.unknown       <- array(0, c(numSim,Ncol))
      CI.feb.sel.unknown       <- array(0, c(numSim,Ncol))
      CI.fes.sel.unknown       <- array(0, c(numSim,Ncol))
      CI.reb.sel.unknown       <- array(0, c(numSim,Ncol))
      CI.Feb.sel.unknown       <- array(0, c(numSim,Ncol))
      
      tauSqhat.sSq                 <- array(0, numSim)
      tauSqhat.ljs                 <- array(0, numSim)
      tauSqhat.opt                 <- array(0, numSim)
      tauSqhat.smy                 <- array(0, numSim)
      tauSqhat.vsh                 <- array(0, numSim)
      tauSqhat.feb                 <- array(0, numSim)
      tauSqhat.fes                 <- array(0, numSim)
      tauSqhat.reb                 <- array(0, numSim)
      tauSqhat.Feb                 <- array(0, numSim)

      bon.sel.unknown.Result   <- array(0, c(N, 4))
      sSq.sel.unknown.Result   <- array(0, c(N, 4))
      ljs.sel.unknown.Result   <- array(0, c(N, 4))
      opt.sel.unknown.Result   <- array(0, c(N, 4))
      smy.sel.unknown.Result   <- array(0, c(N, 4))
      vsh.sel.unknown.Result   <- array(0, c(N, 4))
      feb.sel.unknown.Result   <- array(0, c(N, 4))
      fes.sel.unknown.Result   <- array(0, c(N, 4))
      reb.sel.unknown.Result   <- array(0, c(N, 4))
      Feb.sel.unknown.Result   <- array(0, c(N, 4))
      
      bonR                     <- array(0, c(N, 4))
      sSqR                     <- array(0, c(N, 4))
      ljsR                     <- array(0, c(N, 4))
      optR                     <- array(0, c(N, 4))
      smyR                     <- array(0, c(N, 4))
      vshR                     <- array(0, c(N, 4))
      febR                     <- array(0, c(N, 4))
      fesR                     <- array(0, c(N, 4))
      rebR                     <- array(0, c(N, 4))
      FebR                     <- array(0, c(N, 4))
      
      Result.unknown           <- array(0, c(N,41))
      Result.avg.unknown       <- array(0, c(N,41))
      
      M=seq(0,1,0.999/N)
      M=M[2:(N+1)]
      
      if (prior==1){
        INVGAM=1
      } else if (prior==2){
        LNORM=1
      } else if (prior==3){
        GAM=1
      } else if (prior==4){
        MIXIG=1
      } else if (prior==5){
        MIXGAM=1
      }
      
      ##-- Simulation ---------------------------------------------------------------------------------------------------------------------------------------------------------
      
      for(t in  1:N){
        print( paste("t=",t,sep=""))
        for(i in  1:numSim){
          if( i%% 50==0 )
            {
              print(date())
              print( paste( "number of simulation:", i, sep="") )
            }
          temp       <- runif(G)
          if(INVGAM==1)
            sigmaSq    <- 1/rgamma(G,abs(a),b)
          if(LNORM==1)
            sigmaSq <- rlnorm(G,a,b)
          if(GAM==1)
            sigmaSq <- rgamma(G,abs(a),b)
          if(MIXIG==1)
            sigmaSq <- (temp>0.5)*1/rgamma(G,a,b)+(temp<0.5)*1/rgamma(G,6,4)
          if(MIXGAM==1)
            sigmaSq <- (temp>0.5)*rgamma(G,4,16)+(temp<0.5)*rgamma(G,a,b)

          tauSq      <- M[t]/(1-M[t])
          theta      <- rnorm(G,mu,sqrt(tauSq))
          
          sSq        <- sigmaSq*rchisq(G,df)/df
          xi         <- rnorm(G,theta,sqrt(sigmaSq))
          
          muhat      <- mean(xi) #sum((xi/sSq))/sum(1/sSq)
          T.stat     <- xi/sqrt(sSq)
          max.ind    <- order(abs(T.stat),decreasing=TRUE)[(G/G):(G/G)]
          
          bon        <- sSq
          sSq        <- sSq
          
          if( i==1 )
            {
              if( bw=="ucv")
                {
                  bandwidth <- array(0, 3)
                  bandwidth[1] <- h.ucv(sSq, deriv.order=0)$h
                  bandwidth[2] <- h.ucv(sSq, deriv.order=1)$h
                  bandwidth[3] <- h.ucv(sSq, deriv.order=2)$h
                }else{
                  bandwidth <- array(0.2, 3)
                }
            }
          
          ljs        <- LJS(sSq,df)
          opt        <- OPT(sSq,df)
          smy        <- SMY(sSq,df)
          vsh        <- VSH(sSq,df)
          feb        <- fEB(sSq,df,bandwidth)
          fes        <- fES(sSq,df,bandwidth)
          reb        <- GVmix(sSq, array(df,G) )$dy
          Feb        <- FEB(sSq,df)

          tauSqhat.sSq[i]<- tauSqfn(sSq,xi,muhat,alpha)
          tauSqhat.ljs[i]<- tauSqfn(ljs,xi,muhat,alpha)
          tauSqhat.opt[i]<- tauSqfn(opt,xi,muhat,alpha)
          tauSqhat.smy[i]<- tauSqfn(smy,xi,muhat,alpha)
          tauSqhat.vsh[i]<- tauSqfn(vsh,xi,muhat,alpha)
          tauSqhat.feb[i]<- tauSqfn(feb,xi,muhat,alpha)
          tauSqhat.fes[i]<- tauSqfn(fes,xi,muhat,alpha)
          tauSqhat.reb[i]<- tauSqfn(reb,xi,muhat,alpha)
          tauSqhat.Feb[i]<- tauSqfn(Feb,xi,muhat,alpha)
          
          
          ## CI : tauSq unknown
          CI.bon.unknown   <- CI.bonferroni(sSq,df,xi,theta,sigmaSq,muhat,alpha)
          CI.sSq.unknown   <- CI.t(sSq,df,xi,theta,sigmaSq,muhat,alpha)
          CI.ljs.unknown   <- CI.est(ljs,tauSqhat.ljs[i],xi,theta,sigmaSq,muhat,alpha)
          CI.opt.unknown   <- CI.est(opt,tauSqhat.opt[i],xi,theta,sigmaSq,muhat,alpha)
          CI.smy.unknown   <- CI.est(smy,tauSqhat.smy[i],xi,theta,sigmaSq,muhat,alpha)
          CI.vsh.unknown   <- CI.est(vsh,tauSqhat.vsh[i],xi,theta,sigmaSq,muhat,alpha)
          CI.feb.unknown   <- CI.est(feb,tauSqhat.feb[i],xi,theta,sigmaSq,muhat,alpha)
          CI.fes.unknown   <- CI.est(fes,tauSqhat.fes[i],xi,theta,sigmaSq,muhat,alpha)
          CI.reb.unknown   <- CI.est(reb,tauSqhat.reb[i],xi,theta,sigmaSq,muhat,alpha)
          CI.Feb.unknown   <- CI.est(Feb,tauSqhat.Feb[i],xi,theta,sigmaSq,muhat,alpha)
          
                                        # CI : tauSq unknown - selected
          CI.bon.sel.unknown[i,]   <- CI.bon.unknown[max.ind,]
          CI.sSq.sel.unknown[i,]   <- CI.sSq.unknown[max.ind,]
          CI.ljs.sel.unknown[i,]   <- CI.ljs.unknown[max.ind,]
          CI.opt.sel.unknown[i,]   <- CI.opt.unknown[max.ind,]
          CI.smy.sel.unknown[i,]   <- CI.smy.unknown[max.ind,]
          CI.vsh.sel.unknown[i,]   <- CI.vsh.unknown[max.ind,]
          CI.feb.sel.unknown[i,]   <- CI.feb.unknown[max.ind,]
          CI.fes.sel.unknown[i,]   <- CI.fes.unknown[max.ind,]
          CI.reb.sel.unknown[i,]   <- CI.reb.unknown[max.ind,]
          CI.Feb.sel.unknown[i,]   <- CI.Feb.unknown[max.ind,]
        }

        CI.bon.sel.unknown   <-changenames(CI.bon.sel.unknown)
        CI.sSq.sel.unknown   <-changenames(CI.sSq.sel.unknown)
        CI.ljs.sel.unknown   <-changenames(CI.ljs.sel.unknown)
        CI.opt.sel.unknown   <-changenames(CI.opt.sel.unknown)
        CI.smy.sel.unknown   <-changenames(CI.smy.sel.unknown)
        CI.vsh.sel.unknown   <-changenames(CI.vsh.sel.unknown)
        CI.feb.sel.unknown   <-changenames(CI.feb.sel.unknown)
        CI.fes.sel.unknown   <-changenames(CI.fes.sel.unknown)
        CI.reb.sel.unknown   <-changenames(CI.reb.sel.unknown)
        CI.Feb.sel.unknown   <-changenames(CI.Feb.sel.unknown)
        
        bon.sel.unknown.Result=apply(CI.bon.sel.unknown[,7:10],2,mean);
        sSq.sel.unknown.Result=apply(CI.sSq.sel.unknown[,7:10],2,mean);
        ljs.sel.unknown.Result=apply(CI.ljs.sel.unknown[,7:10],2,mean);
        opt.sel.unknown.Result=apply(CI.opt.sel.unknown[,7:10],2,mean);
        smy.sel.unknown.Result=apply(CI.smy.sel.unknown[,7:10],2,mean);
        vsh.sel.unknown.Result=apply(CI.vsh.sel.unknown[,7:10],2,mean);
        feb.sel.unknown.Result=apply(CI.feb.sel.unknown[,7:10],2,mean);
        fes.sel.unknown.Result=apply(CI.fes.sel.unknown[,7:10],2,mean);
        reb.sel.unknown.Result=apply(CI.reb.sel.unknown[,7:10],2,mean);
        Feb.sel.unknown.Result=apply(CI.Feb.sel.unknown[,7:10],2,mean);
        
        Result.unknown[t,]=c(M[t],bon=bon.sel.unknown.Result,sSq=sSq.sel.unknown.Result,ljs=ljs.sel.unknown.Result,opt=opt.sel.unknown.Result,smy=smy.sel.unknown.Result,vsh=vsh.sel.unknown.Result,feb=feb.sel.unknown.Result,fes=fes.sel.unknown.Result,reb=reb.sel.unknown.Result, Feb=Feb.sel.unknown.Result)
      }
      
      ##-- Saving RData -------------------------------------------------------------------------------------------------------------------
      
      path      <- paste("./Data/")
      path1     <- paste("./Figure/")
      settname  <- paste("Indep_prior_",prior,"_df_",df,"_a_",a,"_b_",b,sep="")
      filename  <- paste(path, settname, ".Rdata", sep="")
      save(Result.unknown, file = filename)
    }
  
  if(PLOT==TRUE)
    {
      path      <- paste("./Data/")
      path1     <- paste("./Figure/")
      settname  <- paste("Indep_prior_",prior,"_df_",df,"_a_",a,"_b_",b,sep="")
      filename  <- paste(path, settname, ".Rdata", sep="")
      load(filename)
    }

  
  ##-- Saving Figures ----------------------------------------------------------------------------------------------------------------------------
  
  if (prior==1){
    PRIOR<-"Inverse Gamma"
  } else if (prior==2){
    PRIOR<-"Lognormal"
  } else if (prior==3){
    PRIOR<-"Gamma"
  } else if (prior==4){
    PRIOR<-"IG Mixture"
  } else if (prior==5){
    PRIOR<-"Gamma Mixture"
  }
  
  ## SOC<-read.csv("./ZEMCISel/SOC.txt", header=FALSE)
  
  ## if (prior==1 && a==2.44  ) {
  ##   socresult<-SOC[,1:2]
  ## } else if (prior==1 && a==3     ){
  ##   socresult<-SOC[,3:4]
  ## } else if (prior==1 && a==6     ){
  ##   socresult<-SOC[,5:6]
  ## } else if (prior==1 && a==18    ){
  ##   socresult<-SOC[,7:8]
  ## } else if (prior==2 && a==-0.723){
  ##   socresult<-SOC[,9:10]
  ## } else if (prior==2 && a==-0.805){
  ##   socresult<-SOC[,11:12]
  ## } else if (prior==2 && a==-1.040){
  ##   socresult<-SOC[,13:14]
  ## } else if (prior==2 && a==-1.282){
  ##   socresult<-SOC[,15:16]
  ## } else if (prior==3 && a==1     ){
  ##   socresult<-SOC[,17:18]
  ## } else if (prior==3 && a==1.78  ){
  ##   socresult<-SOC[,19:20]
  ## } else if (prior==3 && a==4     ){
  ##   socresult<-SOC[,21:22]
  ## } else if (prior==3 && a==16    ){
  ##   socresult<-SOC[,23:24]
  ## } else if (prior==4){
  ##   socresult<-SOC[,25:26]
  ## } else if (prior==4){
  ##   socresult<-SOC[,27:28]
  ## }
  
  ## SOCR<-socresult
  ## Result.unknown=cbind(Result.unknown,socresult[ 2*c(0:(N-1))+1, ] )

  par(mar=c(4, 4, 3, 8))
  xloc=-0.2

  path1 = "./Figure/"
  
  ## Coverage 
  figurename1 <- paste(path1,"Coverage_",settname,".pdf",sep="")
  pdf(figurename1,width=8,height=5)
  par(mar=c(5,5,1,10) )
  Llim=min(Result.unknown[,2],Result.unknown[,10],Result.unknown[,14],Result.unknown[,18],Result.unknown[,22])-0.1
  plot( Result.unknown[,1],Result.unknown[,2], xlab=TeX(r'($\tau^2/(\tau^2+E\sigma^2)$ )'),ylab=TeX(r'(Coverage Prob. of $\theta_{(1)}$)'), ylim=c(0,1), xlim=c(0,1),col="white",main=bquote(paste(.(PRIOR), "    a=",.(a),",  b=",.(b),",  df=",.(df) )), cex.lab=1.2, cex.axis=1.2, cex.main=1.2)
  lines( Result.unknown[,1],rep(0.95-qnorm(0.975)*sqrt(0.05*0.95/500),N), type="l", col="black",lwd=3,lty=2)
  lines( Result.unknown[,1],Result.unknown[,2] , pch=3 , type="b", col="cyan3" ) # Bonferroni
  lines( Result.unknown[,1],Result.unknown[,10], pch=15, type="b", col="blue"  ) # ELJS
  lines( Result.unknown[,1],Result.unknown[,14], pch=7 , type="b", col="purple") # TW
  lines( Result.unknown[,1],Result.unknown[,18], pch=17, type="b", col="green4") # Smyth
  lines( Result.unknown[,1],Result.unknown[,22], pch=16, type="b", col="gold4" ) # Vash
  lines( Result.unknown[,1],Result.unknown[,26], pch=9 , type="b", col="brown" ) # fEBV
  lines( Result.unknown[,1],Result.unknown[,30], pch=8 , type="b", col="orange") # fEBVS
  lines( Result.unknown[,1],Result.unknown[,34], pch=10, type="b", col="green ") # ReBayes
  lines( Result.unknown[,1],Result.unknown[,38], pch=19, type="b", col="red"   ) # FEBV
  ## lines( Result.unknown[,1],Result.unknown[,38], pch=10, type="b", col="green ") # SOC
  par(xpd=TRUE)
  legend("topright",horiz=F, inset = c(-0.3,0.2), legend=c("Error Bar","Bonferroni","ELJS","TW","Smyth","Vash","f-EBV","f-EBVS","REBayes","F-EBV"),col=c("black","cyan3","blue","purple","green4","gold4", "brown","orange","green","red"),pch=c(NA,3,15,7,17,16,9,8,10,19), ncol=1, lty=1:1, cex=1)
  dev.off()
  
  ## Length Ratio
  figurename2 <- paste(path1,"LengRatio_",settname,".pdf",sep="")
  pdf(figurename2,width=8,height=5)
  par(mar=c(5,5,1,10) )
  Llim=max(Result.unknown[,11]/Result.unknown[,3],Result.unknown[,15]/Result.unknown[,3],Result.unknown[,35]/Result.unknown[,3])+0.1
  plot( Result.unknown[,1],Result.unknown[,3], xlab=TeX(r'($\tau^2/(\tau^2+E\sigma^2)$ )'),ylab="Length Ratio", ylim=c(0,Llim+0.2), xlim=c(0,1),col="white",main=bquote(paste(.(PRIOR), "    a=",.(a),",  b=",.(b),",  df=",.(df) )), cex.lab=1.2, cex.axis=1.2, cex.main=1.2)
  lines( Result.unknown[,1],Result.unknown[,11]/Result.unknown[,3], pch=15, type="b", col="blue"  ) # ELJS
  lines( Result.unknown[,1],Result.unknown[,15]/Result.unknown[,3], pch=7 , type="b", col="purple") # TW
  lines( Result.unknown[,1],Result.unknown[,19]/Result.unknown[,3], pch=17, type="b", col="green4") # Smyth
  lines( Result.unknown[,1],Result.unknown[,23]/Result.unknown[,3], pch=16, type="b", col="gold4" ) # Vash
  lines( Result.unknown[,1],Result.unknown[,27]/Result.unknown[,3], pch=9 , type="b", col="brown" ) # fEBV
  lines( Result.unknown[,1],Result.unknown[,31]/Result.unknown[,3], pch=8 , type="b", col="orange") # fEBVS
  lines( Result.unknown[,1],Result.unknown[,35]/Result.unknown[,3], pch=10, type="b", col="green ") # ReBayes
  lines( Result.unknown[,1],Result.unknown[,39]/Result.unknown[,3], pch=19, type="b", col="red"   ) # FEBV
  ##  lines( Result.unknown[,1],Result.unknown[,39]/Result.unknown[,3], pch=10, type="b", col="green ") # SOC
  ## legend("topright",horiz=F, inset = c(-0.3,0), legend=c("ELJS","TW","Smyth","Vash","f-EBV","f-EBVS","F-EBV","SOC"),col=c("blue","purple","green4","gold4", "brown","orange","red","green"),pch=c(15,7,17,16,9,8,19,10), ncol=1, lty=1:1, cex=1)
  dev.off()


  path1     <-"/home/zhaozhg/Dropbox/Apps/Overleaf/On F-modelling based Empirical Bayes Estimation of Variances/figure/"
  
  ## Coverage 
  figurename1 <- paste(path1,"Coverage_",settname,".pdf",sep="")
  pdf(figurename1,width=8,height=5)
  par(mar=c(5,5,1,10) )
  Llim=min(Result.unknown[,2],Result.unknown[,10],Result.unknown[,14],Result.unknown[,18],Result.unknown[,22])-0.1
  plot( Result.unknown[,1],Result.unknown[,2],  xlab=TeX(r'($\tau^2/(\tau^2+E\sigma^2)$ )'),ylab=TeX(r'(Coverage Prob. of $\theta_{(1)}$)'),  ylim=c(0,1), xlim=c(0,1),col="white",main=bquote(paste(.(PRIOR), "    a=",.(a),",  b=",.(b),",  df=",.(df) )), cex.lab=1.2, cex.axis=1.2, cex.main=1.2)
  lines( Result.unknown[,1],rep(0.95-qnorm(0.975)*sqrt(0.05*0.95/500),N), type="l", col="black",lwd=3,lty=2)
  lines( Result.unknown[,1],Result.unknown[,2] , pch=3 , type="b", col="cyan3" ) # Bonferroni
  lines( Result.unknown[,1],Result.unknown[,10], pch=15, type="b", col="blue"  ) # ELJS
  lines( Result.unknown[,1],Result.unknown[,14], pch=7 , type="b", col="purple") # TW
  lines( Result.unknown[,1],Result.unknown[,18], pch=17, type="b", col="green4") # Smyth
  lines( Result.unknown[,1],Result.unknown[,22], pch=16, type="b", col="gold4" ) # Vash
  lines( Result.unknown[,1],Result.unknown[,26], pch=9 , type="b", col="brown" ) # fEBV
  lines( Result.unknown[,1],Result.unknown[,30], pch=8 , type="b", col="orange") # fEBVS
  lines( Result.unknown[,1],Result.unknown[,34], pch=10, type="b", col="green" ) # ReBayes
  lines( Result.unknown[,1],Result.unknown[,38], pch=19, type="b", col="red"   ) # FEBV
  ## lines( Result.unknown[,1],Result.unknown[,38], pch=10, type="b", col="green ") # SOC
  par(xpd=TRUE)
  legend("topright",horiz=F, inset = c(-0.3,0.2), legend=c("Error Bar","Bonferroni","ELJS","TW","Smyth","Vash","f-EBV","f-EBVS","REBayes","F-EBV"),col=c("black","cyan3","blue","purple","green4","gold4", "brown","orange","green","red"),pch=c(NA,3,15,7,17,16,9,8,10,19), ncol=1, lty=1:1, cex=1)
  dev.off()
  
  ## Length Ratio
  figurename2 <- paste(path1,"LengRatio_",settname,".pdf",sep="")
  pdf(figurename2,width=8,height=5)
  par(mar=c(5,5,1,10) )
  Llim=max(Result.unknown[,11]/Result.unknown[,3],Result.unknown[,15]/Result.unknown[,3],Result.unknown[,35]/Result.unknown[,3])+0.1
  plot( Result.unknown[,1],Result.unknown[,3], xlab=TeX(r'($\tau^2/(\tau^2+E\sigma^2)$ )'), ylab="Length Ratio", ylim=c(0,Llim+0.2), xlim=c(0,1),col="white",main=bquote(paste(.(PRIOR), "    a=",.(a),",  b=",.(b),",  df=",.(df) )), cex.lab=1.2, cex.axis=1.2, cex.main=1.2)
  lines( Result.unknown[,1],Result.unknown[,11]/Result.unknown[,3], pch=15, type="b", col="blue"  ) # ELJS
  lines( Result.unknown[,1],Result.unknown[,15]/Result.unknown[,3], pch=7 , type="b", col="purple") # TW
  lines( Result.unknown[,1],Result.unknown[,19]/Result.unknown[,3], pch=17, type="b", col="green4") # Smyth
  lines( Result.unknown[,1],Result.unknown[,23]/Result.unknown[,3], pch=16, type="b", col="gold4" ) # Vash
  lines( Result.unknown[,1],Result.unknown[,27]/Result.unknown[,3], pch=9 , type="b", col="brown" ) # fEBV
  lines( Result.unknown[,1],Result.unknown[,31]/Result.unknown[,3], pch=8 , type="b", col="orange") # fEBVS
  lines( Result.unknown[,1],Result.unknown[,35]/Result.unknown[,3], pch=10, type="b", col="green" ) # ReBayes
  lines( Result.unknown[,1],Result.unknown[,39]/Result.unknown[,3], pch=19, type="b", col="red"   ) # FEBV
  ##  lines( Result.unknown[,1],Result.unknown[,39]/Result.unknown[,3], pch=10, type="b", col="green ") # SOC
  ## legend("topright",horiz=F, inset = c(-0.3,0), legend=c("ELJS","TW","Smyth","Vash","f-EBV","f-EBVS","F-EBV","SOC"),col=c("blue","purple","green4","gold4", "brown","orange","red","green"),pch=c(15,7,17,16,9,8,19,10), ncol=1, lty=1:1, cex=1)
  dev.off()

  
  #-- Showing Figures ----------------------------------------------------------------------------------------------------------------------------
  
  # Coverage 
  Llim=min(Result.unknown[,2],Result.unknown[,10],Result.unknown[,14],Result.unknown[,18],Result.unknown[,22])-0.1
  plot( Result.unknown[,1],Result.unknown[,2],  xlab=TeX(r'($\tau^2/(\tau^2+E\sigma^2)$ )'),ylab=TeX(r'(Coverage Prob. of $\theta_{(1)}$)'), ylim=c(0,1), xlim=c(0,1),col="white",main=bquote(paste(.(PRIOR), "    a=",.(a),",  b=",.(b),",  df=",.(df) )), cex.lab=1.2, cex.axis=1.2, cex.main=1.2)
  lines( Result.unknown[,1],rep(0.95-qnorm(0.975)*sqrt(0.05*0.95/1000),N), type="l", col="black",lwd=3,lty=2)
  lines( Result.unknown[,1],Result.unknown[,2] , pch=3 , type="b", col="cyan3" ) # Bonferroni
  lines( Result.unknown[,1],Result.unknown[,10], pch=15, type="b", col="blue"  ) # ELJS
  lines( Result.unknown[,1],Result.unknown[,14], pch=7 , type="b", col="purple") # TW
  lines( Result.unknown[,1],Result.unknown[,18], pch=17, type="b", col="green4") # Smyth
  lines( Result.unknown[,1],Result.unknown[,22], pch=16, type="b", col="gold4" ) # Vash
  lines( Result.unknown[,1],Result.unknown[,26], pch=9 , type="b", col="brown" ) # fEBV
  lines( Result.unknown[,1],Result.unknown[,30], pch=8 , type="b", col="orange") # fEBVS
  lines( Result.unknown[,1],Result.unknown[,34], pch=10, type="b", col="green" ) # Rebayes
  lines( Result.unknown[,1],Result.unknown[,38], pch=19, type="b", col="red"   ) # FEBV
  ## lines( Result.unknown[,1],Result.unknown[,38], pch=10, type="b", col="green ") # SOC
  legend("topright",horiz=F, inset = c(xloc,0), legend=c("Error Bar","Bonferroni","ELJS","TW","Smyth","Vash","f-EBV","f-EBVS","REBayes","F-EBV"),col=c("black","cyan3","blue","purple","green4","gold4", "brown","orange","green","red"),pch=c(NA,3,15,7,17,16,9,8,10,19), ncol=1, lty=1:1, cex=1)
  
  # Length Ratio
  Llim=max(Result.unknown[,11]/Result.unknown[,3],Result.unknown[,15]/Result.unknown[,3],Result.unknown[,35]/Result.unknown[,3])+0.1
  plot( Result.unknown[,1],Result.unknown[,3],  xlab=TeX(r'($\tau^2/(\tau^2+E\sigma^2)$ )'), ylab="Length Ratio", ylim=c(0,Llim+0.2), xlim=c(0,1),col="white",main=bquote(paste(.(PRIOR), "    a=",.(a),",  b=",.(b),",  df=",.(df) )), cex.lab=1.2, cex.axis=1.2, cex.main=1.2)
  lines( Result.unknown[,1],Result.unknown[,11]/Result.unknown[,3], pch=15, type="b", col="blue"  ) # ELJS
  lines( Result.unknown[,1],Result.unknown[,15]/Result.unknown[,3], pch=7 , type="b", col="purple") # TW
  lines( Result.unknown[,1],Result.unknown[,19]/Result.unknown[,3], pch=17, type="b", col="green4") # Smyth
  lines( Result.unknown[,1],Result.unknown[,23]/Result.unknown[,3], pch=16, type="b", col="gold4" ) # Vash
  lines( Result.unknown[,1],Result.unknown[,27]/Result.unknown[,3], pch=9 , type="b", col="brown" ) # fEBV
  lines( Result.unknown[,1],Result.unknown[,31]/Result.unknown[,3], pch=8 , type="b", col="orange") # fEBVS
  lines( Result.unknown[,1],Result.unknown[,35]/Result.unknown[,3], pch=10, type="b", col="green" ) # ReBayes
  lines( Result.unknown[,1],Result.unknown[,39]/Result.unknown[,3], pch=19, type="b", col="red"   ) # FEBV
  ## lines( Result.unknown[,1],Result.unknown[,39]/Result.unknown[,3], pch=10, type="b", col="green ") # SOC
  legend("topright",horiz=F, inset = c(xloc,0), legend=c("ELJS","TW","Smyth","Vash","f-EBV","f-EBVS","REBayes","F-EBV"),col=c("blue","purple","green4","gold4", "brown","orange","green","red"),pch=c(15,7,17,16,9,8,10,19), ncol=1, lty=1:1, cex=1)

}
